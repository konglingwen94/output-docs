<!DOCTYPE html><!-- saved from url=(0120)http://www.kiscon.top/knowledge/http-cache.html#%E5%BC%BA%E7%BC%93%E5%AD%98%E5%92%8C%E5%8D%8F%E5%95%86%E7%BC%93%E5%AD%98 --><html lang="en-US" class=" "><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    
    <title>http 缓存 | 前端文档</title>
    
    
    
    
    
    
  <meta name="description" content="Front end documentation"><link rel="stylesheet" href="../style.css"></head>
  <body>
    <div id="app"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="http://www.kiscon.top/" class="home-link router-link-active"><!----> <span class="site-name">前端文档</span></a> <div class="links" style="max-width: 2361px;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value="" class="" placeholder=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="http://www.kiscon.top/knowledge/com-design.html" class="nav-link">
  知识库
</a></div><div class="nav-item"><a href="http://www.kiscon.top/solution/plane.html" class="nav-link">
  解决方案
</a></div><div class="nav-item"><a href="http://www.kiscon.top/standard/base.html" class="nav-link">
  规范
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="http://www.kiscon.top/knowledge/com-design.html" class="nav-link">
  知识库
</a></div><div class="nav-item"><a href="http://www.kiscon.top/solution/plane.html" class="nav-link">
  解决方案
</a></div><div class="nav-item"><a href="http://www.kiscon.top/standard/base.html" class="nav-link">
  规范
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>知识库</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items" style=""><li><a href="./组件设计.html" class="sidebar-link">组件设计</a></li><li><a href="./监控平台.html" class="sidebar-link">监控平台</a></li><li><a href="./Web安全.html" class="sidebar-link">Web安全</a></li><li><a href="./Webpack.html" class="sidebar-link">Webpack</a></li><li><a href="./Webpack原理.html" class="sidebar-link">Webpack原理</a></li><li><a href="./Webpack5+.html" class="sidebar-link">Webpack5+</a></li><li><a href="./ES7-12系列.html" class="sidebar-link">ES7-12系列</a></li><li><a href="./脚手架.html" class="sidebar-link">脚手架</a></li><li><a href="./Promise.html" class="sidebar-link">Promise</a></li><li><a href="./Git管控.html" class="sidebar-link">Git管控</a></li><li><a href="./零碎知识.html" class="sidebar-link">零碎知识</a></li><li><a href="./正则.html" class="sidebar-link">正则</a></li><li><a href="./布局方式.html" class="sidebar-link">布局方式</a></li><li><a href="./Require解读.html" class="sidebar-link">Require解读</a></li><li><a href="./BFC与IFC.html" class="sidebar-link">BFC与IFC</a></li><li><a href="./React技术栈.html" class="sidebar-link">React技术栈</a></li><li><a href="./Vue3与Vue2的区别.html" class="sidebar-link">Vue3与Vue2的区别</a></li><li><a href="./移动web.html" class="sidebar-link">移动web</a></li><li><a href="./HTTP状态码.html" class="sidebar-link">HTTP状态码</a></li><li><a href="./HTTP缓存.html" class="active sidebar-link" aria-current="page">HTTP缓存</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="http://www.kiscon.top/knowledge/http-cache.html#%E5%BC%BA%E7%BC%93%E5%AD%98%E5%92%8C%E5%8D%8F%E5%95%86%E7%BC%93%E5%AD%98" class="active sidebar-link" aria-current="page">强缓存和协商缓存</a></li><li class="sidebar-sub-header"><a href="http://www.kiscon.top/knowledge/http-cache.html#%E6%B5%8F%E8%A7%88%E5%99%A8%E7%BC%93%E5%AD%98%E5%88%B7%E6%96%B0" class="sidebar-link">浏览器缓存刷新</a></li><li class="sidebar-sub-header"><a href="http://www.kiscon.top/knowledge/http-cache.html#cache-%E7%BC%93%E5%AD%98%E7%AD%96%E7%95%A5" class="sidebar-link">Cache 缓存策略</a></li><li class="sidebar-sub-header"><a href="http://www.kiscon.top/knowledge/http-cache.html#%E8%BF%94%E5%9B%9E-304-%E7%8A%B6%E6%80%81%E7%A0%81%E7%9A%84%E6%83%85%E5%86%B5" class="sidebar-link">返回 304 状态码的情况</a></li><li class="sidebar-sub-header"><a href="http://www.kiscon.top/knowledge/http-cache.html#cache-control" class="sidebar-link">Cache-Control</a></li><li class="sidebar-sub-header"><a href="http://www.kiscon.top/knowledge/http-cache.html#cache-control-%E5%92%8C-etag-%E7%9A%84%E5%8C%BA%E5%88%AB" class="sidebar-link">Cache-Control 和 ETag 的区别</a></li><li class="sidebar-sub-header"><a href="http://www.kiscon.top/knowledge/http-cache.html#%E5%BC%BA%E7%BC%93%E5%AD%98%E4%B8%8E%E5%BC%B1%E7%BC%93%E5%AD%98%E7%9A%84%E5%8C%BA%E5%88%AB" class="sidebar-link">强缓存与弱缓存的区别</a></li></ul></li><li><a href="./事件循环与多进程.html" class="sidebar-link">事件循环与多进程</a></li><li><a href="./Rollup模块打包器.html" class="sidebar-link">Rollup模块打包器</a></li><li><a href="./小程序.html" class="sidebar-link">小程序</a></li><li><a href="./Vue3与Webpack5.html" class="sidebar-link">Vue3与Webpack5</a></li><li><a href="./Lottie动画解析.html" class="sidebar-link">Lottie动画解析</a></li><li><a href="./Axios核心源码解析.html" class="sidebar-link">Axios核心源码解析</a></li><li><a href="./Typescript应用.html" class="sidebar-link">Typescript应用</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>解决方案</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>规范</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="http-缓存"><a href="http://www.kiscon.top/knowledge/http-cache.html#http-%E7%BC%93%E5%AD%98" class="header-anchor">#</a> http 缓存</h1> <h2 id="强缓存和协商缓存"><a href="http://www.kiscon.top/knowledge/http-cache.html#%E5%BC%BA%E7%BC%93%E5%AD%98%E5%92%8C%E5%8D%8F%E5%95%86%E7%BC%93%E5%AD%98" class="header-anchor">#</a> 强缓存和协商缓存</h2> <ol><li>强缓存时利用 Expires（/ɪk'spaɪəz/&nbsp;）或者 Cache-Control 这两个 http header 实现的，都用来表示资源在客户端缓存的有效期。在 chrome 控制台的 Network 选项中可以看到该请求返回 200 的状态码，并且 Size 显示 from disk cache 或 from memory cache。</li> <li>协商缓存利用的是【Last-Modified、If-Modified-Since】、【ETag、If-None-Match】这两对 header 来管理的。
协商缓存生效，返回 304 和 Not Modified
协商缓存失效，返回 200 和请求结果协商缓存可以通过设置两种 HTTP Header 实现：Last-Modified 和 ETag</li> <li>两者联系：强缓存就是给资源设置个过期时间，客户端每次请求资源时都会看是否过期；只有在过期才会去询问服务器。所以，强缓存就是为了给客户端自给自足用的（浏览器会从本地磁盘或内存中读取缓存并返回 200 状态）。而当某天，客户端请求该资源时发现其过期了，这是就会去请求服务器了，而这时候去请求服务器的这过程就可以设置协商缓存。这时候，协商缓存就是需要客户端和服务器两端进行交互的。</li></ol> <h2 id="浏览器缓存刷新"><a href="http://www.kiscon.top/knowledge/http-cache.html#%E6%B5%8F%E8%A7%88%E5%99%A8%E7%BC%93%E5%AD%98%E5%88%B7%E6%96%B0" class="header-anchor">#</a> 浏览器缓存刷新</h2> <ol><li>在地址栏中输入网址后按回车或者点击转到按钮</li></ol> <p>浏览器以最少的请求来获取网页的数据，浏览器会对所有没有过期的内容直接使用本地缓存即使用强缓存，从而减少了对服务器的请求，Expires、max-age 标志只对这种方式有效。</p> <ol start="2"><li>按 F5 或浏览器刷新按钮</li></ol> <p>浏览器会在请求中附加必要的缓存协商，但不允许浏览器直接使用本地缓存即跳过强缓存的判断，直接进行协商缓存的判断，Last-Modified、ETag 在这种方式发挥作用。</p> <ol start="3"><li>按 Ctrl+F5 或按 Ctrl 并点击刷新按钮</li></ol> <p>强制刷新，完全不使用缓存</p> <h2 id="cache-缓存策略"><a href="http://www.kiscon.top/knowledge/http-cache.html#cache-%E7%BC%93%E5%AD%98%E7%AD%96%E7%95%A5" class="header-anchor">#</a> Cache 缓存策略</h2> <p><img src="./http 缓存 _ 前端文档_files/cache-3.png" alt="images"></p> <h2 id="返回-304-状态码的情况"><a href="http://www.kiscon.top/knowledge/http-cache.html#%E8%BF%94%E5%9B%9E-304-%E7%8A%B6%E6%80%81%E7%A0%81%E7%9A%84%E6%83%85%E5%86%B5" class="header-anchor">#</a> 返回 304 状态码的情况</h2> <div class="language- extra-class"><pre class="language-text"><code>// response header
ETag: '5c20abbd-e2e8'
Last-Modified: Mon, 24 Dec 2019 09:49:49 GMT

// request header 变为
If-None-Match: '5c20abbd-e2e8'
If-Modified-Since: Mon, 24 Dec 2019 09:49:49 GMT
</code></pre></div><h3 id="场景一"><a href="http://www.kiscon.top/knowledge/http-cache.html#%E5%9C%BA%E6%99%AF%E4%B8%80" class="header-anchor">#</a> 场景一</h3> <p>● Request Headers 的 Cache 头域</p> <p>If-Modified-Since：即本地文件的修改时间。</p> <p>● Response Headers 的 Entity</p> <p>Last-Modified：即服务器上文件的修改时间。</p> <p>详解： 把浏览器端缓存页面的最后修改时间发送到服务器去，服务器会把这个时间与服务器上实际文件的最后修改时间进行对比。如果在 If-Modified-Since 字段指定的日期时间后，资源发生了更新，服务器会接受请求，就会返回 200 和新的文件内容。如果没有更新，那么返回 304，客户端就直接使用本地缓存文件。</p> <h3 id="场景二"><a href="http://www.kiscon.top/knowledge/http-cache.html#%E5%9C%BA%E6%99%AF%E4%BA%8C" class="header-anchor">#</a> 场景二</h3> <p>● Request Headers 的 Cache 头域</p> <p>If-None-Match</p> <p>● Response Headers 的 Entity</p> <p>ETag</p> <p>详解：在 HTTP Response 中添加 ETag 信息。 当用户再次请求该资源时，将在 HTTP Request 中加入 If-None-Match 信息(ETag 的值)。如果服务器验证资源的 ETag 没有改变（该资源没有更新），将返回一个 304 状态告诉客户端使用本地缓存文件。否则将返回 200 状态和新的资源和 Etag。使用这样的机制将提高网站的性能。
ETag 是 HTTP1.1 产物，服务器通过某种算法，给资源计算出一个唯一的标志符，可能是一个资源的 MD5 值。</p> <p><img src="./http 缓存 _ 前端文档_files/cache-2.png" alt="images"></p> <h2 id="cache-control"><a href="http://www.kiscon.top/knowledge/http-cache.html#cache-control" class="header-anchor">#</a> Cache-Control</h2> <p>首部字段 Cache-Control 能够控制缓存</p> <ol><li>缓存请求指令</li></ol> <p><img src="./http 缓存 _ 前端文档_files/cache-0.png" alt="images"></p> <ol start="2"><li>缓存响应指令</li></ol> <p><img src="./http 缓存 _ 前端文档_files/cache-1.png" alt="images"></p> <ol start="3"><li>指令作用</li></ol> <p>1）Cache-Control: public</p> <p>表明其他用户也可以利用缓存</p> <p>2）Cache-Control: private</p> <p>缓存服务器会对该特定用户提供资源缓存的服务，对于其他用户发送过来的请求，代理服务器则不会返回缓存</p> <p>3）Cache-Control: no-cache</p> <p>防止从缓存中返回过期的资源。如果服务器返回的响应中包含 no-cache 指令，那么缓存服务器不能对资源进行缓存。</p> <p>4）Cache-Control: no-store</p> <p>不进行缓存</p> <p>no-cache 和 no-store 的区别：&nbsp;no-cache 代表不缓存过期的资源，缓存会向源服务器进行有效期确认后处理资源。no-store 才是真正地不进行缓存。</p> <p>5）Cache-Control: max-age=604800（单位：秒）</p> <p>客户端：发送的请求中包含 max-age 指令时，如果判定缓存资源的缓存时间数值比指定时间的数值更小，那么客户端就接收缓存的资源。</p> <p>服务端：服务器返回的响应中包含 max-age 指令时，缓存服务器将不对资源的有效性再作确认，而 max-age 数值代表资源保存为缓存的最长时间。</p> <p>6）Cache-Control: min-fresh=60（单位：秒）</p> <p>要求缓存服务器返回至少还未过指定时间的缓存资源。</p> <p>7）Cache-Control: max-stale=3600（单位：秒）</p> <p>指示缓存资源，即使过期也照常接收。</p> <p>8）Cache-Control: only-if-cached</p> <p>表示客户端仅在缓存服务器本地缓存目标资源的情况下才会要求其返回。换言之，该指令要求缓存服务器不重新加载响应，也不会再次确认资源有效性。若发生请求缓存服务器的本地缓存无响应，则返回状态码 504 Gateway Timeout。</p> <p>9）Cache-Control: must-revalidate</p> <p>代理会向源服务器再次验证即将返回的响应缓存目前是否仍然有效。</p> <p>10）Cache-Control: proxy-revalidate</p> <p>要求所有的缓存服务器在接收到客户端带有该指令的请求返回响应之前，必须再次验证缓存的有效性。</p> <p>11）Cache-Control: no-transform</p> <p>无论是在请求还是响应中，缓存都不能改变实体主体的媒体类型。</p> <h2 id="cache-control-和-etag-的区别"><a href="http://www.kiscon.top/knowledge/http-cache.html#cache-control-%E5%92%8C-etag-%E7%9A%84%E5%8C%BA%E5%88%AB" class="header-anchor">#</a> Cache-Control 和 ETag 的区别</h2> <ol><li>Cache-Control 的首部字段较多</li> <li>倘若 Cache-Control 设置的缓存没过期，那直接从本地读取缓存即可，返回 200（from cache），不需要向服务端发起请求。</li> <li>使用 ETag 会向服务端发起请求，校验后服务端再决定是否返回资源。</li></ol> <h2 id="强缓存与弱缓存的区别"><a href="http://www.kiscon.top/knowledge/http-cache.html#%E5%BC%BA%E7%BC%93%E5%AD%98%E4%B8%8E%E5%BC%B1%E7%BC%93%E5%AD%98%E7%9A%84%E5%8C%BA%E5%88%AB" class="header-anchor">#</a> 强缓存与弱缓存的区别</h2> <ol><li>获取资源形式： 都是从缓存中获取资源的。</li> <li>状态码：强缓存返回 200(from cache)，弱缓存返回 304 状态码</li> <li>请求(最大区别)：强缓存不发送请求，直接从缓存中取。弱缓存需要发送一个请求，验证这个文件是否可以使用（有没有被改动过）。</li> <li>缓存位置
<ol><li>memory cache：将资源缓存到内存里面。刷新页面就会情况</li> <li>disk cache:将资源缓存到磁盘中。刷新页面不会清空</li></ol></li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="http://www.kiscon.top/knowledge/http-state.html" class="prev">
        HTTP状态码
      </a></span> <span class="next"><a href="http://www.kiscon.top/knowledge/event-process.html" class="">
        事件循环与多进程
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    
  

<script>
  const sidebarLinks = document.querySelectorAll('#app > div.theme-container > aside > ul > li:nth-child(1) > section > ul > li > a.sidebar-link');
  sidebarLinks.forEach(item => {
    const href = item.href.split('/').pop();
    item.setAttribute('href', `./${item.textContent}.html`);
  });
</script></body></html>